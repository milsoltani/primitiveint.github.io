---
import FormattedDate from "./FormattedDate.astro"
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<div class="blog-index">
  <section class="index-section">
    {
      posts.map((post) => (
        <article class="index-post">
          <a href={`/blog/${post.id}/`}>
            <h4 class="post-title">{post.data.title}</h4>
          </a>

          {!!post.data.heroImage && <img width={720} height={260} src={post.data.heroImage} alt="" />}

          <p class="post-description">
            {post.data.description}
          </p>

          <p class="post-meta">
            <a href={`/blog/${post.id}/`}>Read more</a>

            <FormattedDate date={post.data.pubDate} />
          </p>
        </article>
      ))
    }
  </section>
</div>

<style>
  .index-post {
    margin-bottom: 5em;
  }
  .blog-index {
		background: white;
		box-shadow: 0 2px 8px rgba(var(--black), 5%);
	}
  .blog-index a {
		text-decoration: none;
  }
  .index-section {
		width: 720px;
    max-width: calc(100% - 2em);
    margin: auto;
    padding: 3em 1em;
  }
  .post-meta {
    color: #999;
    display: flex;
    justify-content: space-between;
  }
  .post-meta a {
    color: #555;
  }
  .post-description {
    text-align: start;
  }
</style>